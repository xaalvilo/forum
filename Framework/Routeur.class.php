<?phpnamespace Framework;require_once './Framework/autoload.php';/**  *  la classe Routeur a pour r√¥le d'analyser une requ√™te entrante afin d'en d√©duire le contr√¥leur √† utiliser ainsi que l'action (methode) √† ex√©cuter. Il s'agit d'un contr√¥leur frontal  */class Routeur{         /* constante de classe d√©terminant la page d'accueil */    const PAGE_ACCUEIL = "Forum" ;         /**     * M√©thode principale appel√©e par le contr√¥leur frontal. Elle examine la requ√™te et ex√©cute l'action appropri√©e    */    public function routerRequete(Application$app)    {              try         {            // instanciation de l'objet Requ√™te, Fusion des param√®tres GET et POST de la requ√™te            // Permet de g√©rer uniform√©ment ces deux types de requ√™te HTTP            $requete = new Requete($app,array_merge($_GET,$_POST));            // cr√©ation du controleur associ√© √† l'action de la requete            $controleur = $this->creerControleur($requete);            // d√©termination de l'action √† ex√©cuter            $action= $this->creerAction($requete);            // ex√©cuter la m√©thode du controleur correspondant √† l'action            $controleur->executerAction($action);        }        catch (\Exception $e)        {            $this->gererErreur($e);        }    }                 /**     * M√©hode priv√©e permettant de cr√©er le controleur adapt√© √† la requete entrante et renvoyant une instance de la classe associ√©e    *    * @param Requete $requete Requ√™te re√ßue    * @return Instance d'un contr√¥leur    * @throws Exception Si la cr√©ation du contr√¥leur √©choue    */       private function creerControleur(Requete $requete)    {                // Gr√¢ce √† la redirection, toutes les URL entrantes sont du type :        /* index.php?controleur=XXX&action=YYY&id=ZZZ */                // il s'agit de d√©finir le controleur par defaut         $controleur = self::PAGE_ACCUEIL;                // puis de cr√©er le nom du controleur √† activer        if ($requete->existeParametre('controleur'))        {            $controleur=$requete->getParametre('controleur');            // met la premi√®re lettre en majuscule par coh√©rence √† la convention de nommage des fichiers            // Controleur/Controleur<$controleur>.php , apr√®s avoir tout converti en minuscule             $controleur = ucfirst(strtolower($controleur));        }                //  cr√©ation du nom de la classe controleur correspondante         $classeControleur = "Controleur".$controleur;                // cr√©ation du nom du fichier du controleur dans le r√©pertoire "Controleur" de notre arborescence         $fichierControleur = "Controleur/" .$classeControleur . ".class.php" ;                // si ce fichier existe, instanciation de l'objet controleur associ√© √† l'action         if (file_exists($fichierControleur))        {            // inclusion du script du controleur             //require($fichierControleur) ; pas utile il y a déjà l'autoload                        // recuperation de l'application exécutée            $app = $requete->app();                        // instanciation du controleur adapt√© √† la requ√™te            $NamespaceClasseControleur = "\\Controleur\\".$classeControleur;                        $controleur = new $NamespaceClasseControleur ($app);                        // le requete en param√®tre est associ√©e √† ce controleur */            $controleur->setRequete($requete);            return $controleur ;        }        else        {            throw new \Exception ("Fichier '$fichierControleur' introuvable");        }    }        /**     *  M√©thode permettant de d√©terminer l'action √† ex√©cuter  en fonction de la requete entrante    *     * @param Requete $requete Requ√™te re√ßue    * @return string $action Action √† ex√©cuter    */           private function creerAction (Requete $requete)    {        //index est toujours l'action par defaut         $action = "index" ;                // v√©rification de l'existence du parametre action         if ($requete->existeParametre('action'))        {            //r√©cup√©ration de l'action de la requete re√ßue            $action = $requete->getParametre('action') ;         }                //envoi de l'action r√©cup√©r√©e ou de celle par d√©faut */        return $action ;    }            /**     *  M√©thode permettant de g√©rer les erreurs d'ex√©cution et d'afficher les messages dans une vue d√©di√©e aux erreurs    *    * @param Exception $exception Exception intercept√©e    */           private function gererErreur (\Exception $exception)    {        $vue = new Vue('erreur');        $vue->generer(array('msgErreur'=>$exception->getMessage()));    }  }      